/********************************************
* Quttons.js                                *
* Quttons are buttons made of Quantum Paper *
* Author : Nash Vail       		              *
* @license MIT															*
*********************************************/
!function(){"use strict";function t(t){this.$container=t,this.$dialog=this.$container.children,this.$closeButton=this.$container.querySelectorAll(".close"),this.isOpen=!1,this.dialogConfig={width:parseInt(getComputedStyle(this.$dialog[0]).width),height:parseInt(getComputedStyle(this.$dialog[0]).height),backgroundColor:n(getComputedStyle(this.$dialog[0])["background-color"]),borderRadius:getComputedStyle(this.$dialog[0])["border-radius"],zIndex:getComputedStyle(this.$dialog[0])["z-index"]},this.quttonConfig={width:60,height:60,backgroundColor:"#EB1220",icon:"",easing:"easeInOutQuint"}}function n(t){return t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),t&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""}function i(t){t=t||{};for(var n=1;n<arguments.length;n++){var o=arguments[n];if(o)for(var e in o)o.hasOwnProperty(e)&&("object"==typeof o[e]?i(t[e],o[e]):t[e]=o[e])}return t}function o(t,n){for(var i=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(i.call(t,n))return t;t=t.parentElement}return[]}window.Qutton={},window.Qutton.getInstance=function(n){if(null===n)throw new Error("Passed in element doesn't exist in DOM");return new t(n)},t.prototype.init=function(t){i(this.quttonConfig,t),this.$dialog[0].style.display="none",this.setIcon(),this.$container.style.width=this.quttonConfig.width+"px",this.$container.style.height=this.quttonConfig.height+"px",this.$container.style.backgroundColor=this.quttonConfig.backgroundColor,this.$container.style.borderRadius=this.quttonConfig.height+"px",this.events.click.call(this),this.events.click_document.call(this),this.events.click_close_button.call(this)},t.prototype.closeDialog=function(){var t=this;t.isOpen?(t.setIcon(),t.animateOut()):t.isOpening&&setTimeout(function(){t.closeDialog()},100)},t.prototype.openDialog=function(){this.removeIcon(),this.animateIn()},t.prototype.setIcon=function(){this.$container.style.backgroundImage="url("+this.quttonConfig.icon+")",this.$container.style.cursor="pointer"},t.prototype.removeIcon=function(){this.$container.style.backgroundImage="none",this.$container.style.cursor="auto"},t.prototype.animateIn=function(){var t=this;if(t.isOpening!==!0){t.isOpening=!0;var n={X:-1*(this.dialogConfig.width/2-this.quttonConfig.width/2),Y:-.5*(this.dialogConfig.height/2-this.quttonConfig.width/2)},i=[{e:this.$container,p:{width:this.dialogConfig.width+"px",height:this.dialogConfig.height+"px",borderRadius:this.dialogConfig.borderRadius,backgroundColor:this.dialogConfig.backgroundColor,translateX:n.X+this.keepInBounds().X+"px",translateY:n.Y+this.keepInBounds().Y+"px"},o:{duration:500,easing:this.quttonConfig.easing,begin:function(){var n,i=t.$container.nextElementSibling;i&&i.classList.contains("quttonClonePlaceHolder")||(n=t.$container.cloneNode(!0),n.classList.add("quttonClonePlaceHolder"),t.$container.parentNode.insertBefore(n,i)),t.$container.style.position="absolute",t.$container.style.zIndex="10000"},complete:function(){t.isOpen=!0,t.isOpening=!1}}},{e:this.$dialog,p:"fadeIn",o:{duration:300,complete:function(){t.isOpen=!0}}}];Velocity.RunSequence(i)}},t.prototype.animateOut=function(){var t=this;if(t.closing!==!0){t.closing=!0;var n=[{e:this.$dialog,p:"fadeOut",o:{duration:150}},{e:this.$container,p:{width:this.quttonConfig.width+"px",height:this.quttonConfig.height+"px",backgroundColor:this.quttonConfig.backgroundColor,borderRadius:this.quttonConfig.width,translateX:"0px",translateY:"0px"},o:{easing:this.quttonConfig.easing,duration:200,complete:function(){var n=t.$container.nextElementSibling;n&&n.classList.contains("quttonClonePlaceHolder")&&n.parentNode.removeChild(n),t.$container.style.position="static",t.$container.style.zIndex=t.dialogConfig.zIndex,t.isOpen=!1,t.closing=!1}}}];Velocity.RunSequence(n)}},t.prototype.keepInBounds=function(){var t=window.document.documentElement.clientWidth,n=window.document.documentElement.clientHeight,i={left:this.$container.offsetLeft,top:this.$container.offsetTop},o={top:i.top,left:i.left+this.quttonConfig.width/2},e={top:o.top-.5*(this.dialogConfig.height/2-this.quttonConfig.height/2),left:o.left-this.dialogConfig.width/2},s={left:e.left,right:t-(e.left+this.dialogConfig.width),top:e.top,bottom:n-(e.top+this.dialogConfig.height)},a={X:this.calculateTranslateAmount(s.left,s.right),Y:this.calculateTranslateAmount(s.top,s.bottom)};return a},t.prototype.calculateTranslateAmount=function(t,n){return 0>t&&0>n||t>0&&n>0?0:0>t?-t:n},t.prototype.events={click:function(){var t=this;this.$container.addEventListener("click",function(){t.isOpen||t.openDialog()})},click_document:function(){var t=this;document.addEventListener("click",function(n){o(n.target,t.$container.selector).length||t.isOpen&&t.closeDialog()})},click_close_button:function(){var t=this;this.$closeButton.length&&this.$closeButton.addEventListener("click",function(n){t.isOpen&&t.closeDialog()})}}}();